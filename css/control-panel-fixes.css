/* ========================================
   CONTROL PANEL LAYOUT FIXES
   Targeted improvements without breaking existing structure
   ======================================== */

/* Fix overall layout structure */
body {
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
}

.control-panel {
    width: 100vw !important;
    height: 100vh !important;
    max-width: 1920px !important;
    max-height: 1080px !important;
    display: grid !important;
    grid-template-rows: auto 1fr !important;
    overflow: hidden !important;
}

/* Fix header layout */
.matrix-header {
    display: grid !important;
    grid-template-columns: 250px 1fr 200px 180px 260px !important;
    gap: 10px !important;
    padding: 10px !important;
    height: auto !important;
    align-items: stretch !important;
}

/* Fix main control grid */
.control-grid {
    display: grid !important;
    grid-template-columns: 300px 260px 260px 1fr !important;
    grid-template-rows: 180px 180px 1fr !important;
    gap: 10px !important;
    padding: 10px !important;
    height: calc(100vh - 150px) !important;
    overflow: hidden !important;
}

/* Scene Select - Column 1, Rows 1-2 */
.scene-control {
    grid-column: 1 !important;
    grid-row: 1 / 3 !important;
}

.scene-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 6px !important;
    overflow-y: auto !important;
    max-height: 320px !important;
    padding-right: 5px !important;
}

.scene-btn {
    height: 32px !important;
    font-size: 9px !important;
    padding: 4px !important;
}

/* Color Matrix - Column 2, Row 1 */
.color-control {
    grid-column: 2 !important;
    grid-row: 1 !important;
}

/* Tempo - Column 2, Row 2 */
.speed-control {
    grid-column: 2 !important;
    grid-row: 2 !important;
}

/* FX Intensity - Column 3, Row 1 */
.effects-control {
    grid-column: 3 !important;
    grid-row: 1 !important;
}

/* Trigger FX - Column 3, Row 2 */
.trigger-control {
    grid-column: 3 !important;
    grid-row: 2 !important;
}

/* Animation System - Columns 1-3, Row 3 */
.section--animation {
    grid-column: 1 / 4 !important;
    grid-row: 3 !important;
}

/* Visual Effects & Layers - Column 4, Rows 1-3 */
.effects-layers-control {
    grid-column: 4 !important;
    grid-row: 1 / -1 !important;
}

/* Fix control sections */
.control-section {
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    padding: 10px !important;
}

.control-section h2 {
    font-size: 11px !important;
    margin: 0 0 8px 0 !important;
    padding: 0 0 5px 0 !important;
    border-bottom: 1px solid #003311 !important;
}

/* Fix sliders */
.slider-container {
    display: grid !important;
    grid-template-columns: 70px 1fr 40px !important;
    align-items: center !important;
    gap: 6px !important;
    margin-bottom: 6px !important;
}

.slider-container label {
    font-size: 9px !important;
    text-align: right !important;
}

.control-slider {
    height: 18px !important;
}

.slider-value {
    font-size: 9px !important;
    text-align: center !important;
}

/* Fix Animation System layout */
.animation-grid {
    display: grid !important;
    grid-template-columns: 180px 1fr !important;
    gap: 10px !important;
    height: calc(100% - 30px) !important;
}

.animation-head {
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
}

.anime-status-panel {
    padding: 6px !important;
}

.system-control-grid {
    display: grid !important;
    grid-template-rows: repeat(3, 30px) !important;
    gap: 4px !important;
}

.system-btn {
    height: 100% !important;
    font-size: 9px !important;
    padding: 4px !important;
}

.trigger-control-grid {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 6px !important;
    overflow-y: auto !important;
    padding-right: 5px !important;
}

.anim-trigger-btn {
    height: 45px !important;
    font-size: 8px !important;
    padding: 4px !important;
}

.trigger-label {
    font-size: 8px !important;
}

.trigger-desc {
    font-size: 7px !important;
}

/* Fix Visual Effects & Layers */
.ve-layout {
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
    height: calc(100% - 30px) !important;
    overflow: hidden !important;
}

.master-controls {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 6px !important;
}

.master-btn {
    height: 28px !important;
    font-size: 9px !important;
}

.ve-effects {
    flex: 1 !important;
    overflow-y: auto !important;
    padding-right: 5px !important;
}

.effect-toggles {
    display: flex !important;
    flex-direction: column !important;
    gap: 6px !important;
}

.ve-group {
    padding: 6px !important;
    margin-bottom: 6px !important;
}

.ve-group legend {
    font-size: 9px !important;
}

.toggle-item {
    display: grid !important;
    grid-template-columns: 1fr auto !important;
    align-items: center !important;
    gap: 6px !important;
    margin-bottom: 4px !important;
}

.toggle-item label {
    font-size: 9px !important;
}

.effect-toggle-btn {
    width: 42px !important;
    height: 20px !important;
    font-size: 8px !important;
}

/* Fix Trigger FX section */
.trigger-toolbar {
    display: flex !important;
    gap: 8px !important;
    margin-bottom: 8px !important;
    padding-bottom: 6px !important;
}

.theme-group {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 4px !important;
    flex: 1 !important;
}

.theme-btn {
    height: 22px !important;
    font-size: 8px !important;
}

.mini-sliders {
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
}

.mini-sliders label {
    font-size: 8px !important;
}

.mini-sliders input[type="range"] {
    width: 50px !important;
    height: 12px !important;
}

.mini-value {
    font-size: 8px !important;
    width: 20px !important;
}

.trigger-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 4px !important;
    flex: 1 !important;
    overflow-y: auto !important;
    max-height: 100px !important;
    padding-right: 5px !important;
}

.trigger-btn {
    height: 24px !important;
    font-size: 8px !important;
    padding: 2px 4px !important;
}

.macro-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 4px !important;
    margin-top: 6px !important;
    padding-top: 6px !important;
}

.macro-btn {
    height: 24px !important;
    font-size: 8px !important;
}

/* Fix BPM controls */
.bpm-display {
    display: grid !important;
    grid-template-columns: auto 50px auto !important;
    align-items: center !important;
    gap: 6px !important;
    margin-top: 6px !important;
    padding-top: 6px !important;
}

.tap-btn {
    height: 24px !important;
    font-size: 9px !important;
}

.bpm-value {
    font-size: 12px !important;
}

.bpm-options {
    display: grid !important;
    grid-template-columns: auto 1fr !important;
    align-items: center !important;
    gap: 6px !important;
    margin-top: 6px !important;
}

.bpm-toggle-btn {
    height: 20px !important;
    font-size: 8px !important;
    padding: 0 8px !important;
}

/* Fix header components */
.live-preview {
    height: 100% !important;
    min-height: 100px !important;
}

.preview-frame-wrap {
    height: calc(100% - 25px) !important;
}

.preview-video {
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important;
}

.metrics-grid {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 8px !important;
}

.metric-cell {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
}

.metric-value {
    font-size: 14px !important;
}

.dice-container {
    display: flex !important;
    gap: 6px !important;
    align-items: center !important;
}

.controls-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 4px !important;
}

.matrix-control-btn {
    height: 40px !important;
    font-size: 9px !important;
}

.performance-modes {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 4px !important;
    margin-top: 6px !important;
}

.mode-btn {
    height: 28px !important;
    font-size: 9px !important;
}

/* Reset button styling */
.reset-btn {
    height: 24px !important;
    font-size: 9px !important;
    margin-top: 6px !important;
}

/* Scrollbar improvements */
::-webkit-scrollbar {
    width: 5px !important;
    height: 5px !important;
}

::-webkit-scrollbar-track {
    background: #001a0a !important;
}

::-webkit-scrollbar-thumb {
    background: #003311 !important;
    border-radius: 2px !important;
}

::-webkit-scrollbar-thumb:hover {
    background: #00ff41 !important;
}

/* Ensure proper overflow handling */
.control-section > *:last-child {
    margin-bottom: 0 !important;
}

/* Fix layer visibility */
.layer-controls {
    display: flex !important;
    flex-direction: column !important;
    gap: 6px !important;
}

.layer-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 4px !important;
}

.layer-item {
    display: grid !important;
    grid-template-columns: 20px 1fr auto !important;
    align-items: center !important;
    gap: 6px !important;
    padding: 4px !important;
}

.layer-visibility {
    width: 18px !important;
    height: 18px !important;
    font-size: 10px !important;
}

.layer-name {
    font-size: 9px !important;
}

.layer-type {
    font-size: 8px !important;
}

/* Ensure all sections fit properly */
.control-section {
    min-height: 0 !important;
}

/* Fix Lottie controls */
#lottieEffectControls {
    display: flex !important;
    flex-direction: column !important;
    gap: 6px !important;
}

.lottie-toggle-grid {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 4px !important;
}

/* Ensure proper z-index stacking */
.matrix-header {
    z-index: 100 !important;
}

.control-grid {
    z-index: 10 !important;
}

/* Fix any overflow issues */
.section--animation .animation-triggers {
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
}

.section--animation h3 {
    font-size: 10px !important;
    margin: 0 0 6px 0 !important;
}

/* Ensure buttons are clickable */
button {
    cursor: pointer !important;
}

button:disabled {
    opacity: 0.5 !important;
    cursor: not-allowed !important;
}